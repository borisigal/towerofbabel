# TowerOfBabel - Fullstack Architecture Document

## Table of Contents

- [TowerOfBabel - Fullstack Architecture Document](#table-of-contents)
  - [Table of Contents](./table-of-contents.md)
  - [1. Introduction](./1-introduction.md)
    - [Change Log](./1-introduction.md#change-log)
    - [Starter Template Decision](./1-introduction.md#starter-template-decision)
  - [2. High Level Architecture](./2-high-level-architecture.md)
    - [Technical Summary](./2-high-level-architecture.md#technical-summary)
    - [Platform and Infrastructure Choice](./2-high-level-architecture.md#platform-and-infrastructure-choice)
    - [Repository Structure](./2-high-level-architecture.md#repository-structure)
    - [High Level Architecture Diagram](./2-high-level-architecture.md#high-level-architecture-diagram)
    - [Architectural Patterns](./2-high-level-architecture.md#architectural-patterns)
  - [3. Tech Stack](./3-tech-stack.md)
    - [Technology Stack Table](./3-tech-stack.md#technology-stack-table)
    - [Key Technology Decisions Explained](./3-tech-stack.md#key-technology-decisions-explained)
    - [Version Pinning Strategy](./3-tech-stack.md#version-pinning-strategy)
    - [Dependency Count Target](./3-tech-stack.md#dependency-count-target)
  - [4. Data Models](./4-data-models.md)
    - [Core Data Models Overview](./4-data-models.md#core-data-models-overview)
    - [Model 1: User](./4-data-models.md#model-1-user)
    - [Model 2: Interpretation](./4-data-models.md#model-2-interpretation)
    - [Model 3: Subscription](./4-data-models.md#model-3-subscription)
    - [Model 4: LemonSqueezyEvent (NEW - Idempotency)](./4-data-models.md#model-4-lemonsqueezyevent-new-idempotency)
    - [Prisma Schema](./4-data-models.md#prisma-schema)
    - [Shared TypeScript Types for Frontend/Backend](./4-data-models.md#shared-typescript-types-for-frontendbackend)
  - [5. API Specification](./5-api-specification.md)
    - [REST API Specification](./5-api-specification.md#rest-api-specification)
  - [6. Components](./6-components.md)
    - [Component Architecture Overview](./6-components.md#component-architecture-overview)
    - [Component 1: Authentication Service](./6-components.md#component-1-authentication-service)
    - [Component 2: LLM Provider Service](./6-components.md#component-2-llm-provider-service)
    - [Component 3: Cost Circuit Breaker (CRITICAL)](./6-components.md#component-3-cost-circuit-breaker-critical)
    - [Component 4: Usage Tracking Service](./6-components.md#component-4-usage-tracking-service)
    - [Component 5: Lemon Squeezy Integration Service](./6-components.md#component-5-lemon-squeezy-integration-service)
    - [Component 6: Interpretation Form (Frontend)](./6-components.md#component-6-interpretation-form-frontend)
    - [Component Diagram](./6-components.md#component-diagram)
  - [7. External APIs](./7-external-apis.md)
    - [LLM Provider APIs](./7-external-apis.md#llm-provider-apis)
      - [OpenAI API](./7-external-apis.md#openai-api)
      - [Anthropic API (Claude)](./7-external-apis.md#anthropic-api-claude)
      - [xAI API (Grok)](./7-external-apis.md#xai-api-grok)
      - [Google AI API (Gemini)](./7-external-apis.md#google-ai-api-gemini)
    - [Lemon Squeezy API](./7-external-apis.md#lemon-squeezy-api)
    - [Supabase Auth API](./7-external-apis.md#supabase-auth-api)
    - [Vercel KV (Redis) API](./7-external-apis.md#vercel-kv-redis-api)
  - [8. Core Workflows](./8-core-workflows.md)
    - [Workflow 1: First-Time User Sign-Up → First Interpretation](./8-core-workflows.md#workflow-1-first-time-user-sign-up-first-interpretation)
    - [Workflow 2: Trial Limit Exceeded → Upgrade to Pro](./8-core-workflows.md#workflow-2-trial-limit-exceeded-upgrade-to-pro)
  - [9. Database Schema](./9-database-schema.md)
  - [10. Frontend Architecture](./10-frontend-architecture.md)
    - [Component Organization (Feature-Based)](./10-frontend-architecture.md#component-organization-feature-based)
    - [Routing Architecture (Next.js App Router)](./10-frontend-architecture.md#routing-architecture-nextjs-app-router)
    - [State Management](./10-frontend-architecture.md#state-management)
  - [11. Backend Architecture](./11-backend-architecture.md)
    - [API Route Organization](./11-backend-architecture.md#api-route-organization)
    - [API Route Template (with CRITICAL mitigations)](./11-backend-architecture.md#api-route-template-with-critical-mitigations)
  - [12. Unified Project Structure](./12-unified-project-structure.md)
  - [13. Development Workflow](./13-development-workflow.md)
    - [Environment Variables](./13-development-workflow.md#environment-variables)
    - [Setup Commands](./13-development-workflow.md#setup-commands)
    - [Development Commands](./13-development-workflow.md#development-commands)
  - [14. Critical Risk Mitigation](./14-critical-risk-mitigation.md)
    - [Risk 1: Supabase Auth JWT Session Delay Breaks Payment Flow](./14-critical-risk-mitigation.md#risk-1-supabase-auth-jwt-session-delay-breaks-payment-flow)
    - [Risk 2: PostgreSQL Connection Pool Exhaustion Under Load](./14-critical-risk-mitigation.md#risk-2-postgresql-connection-pool-exhaustion-under-load)
    - [Risk 3: LLM API Cost Spike Destroys Margins](./14-critical-risk-mitigation.md#risk-3-llm-api-cost-spike-destroys-margins)
    - [Implementation Checklist](./14-critical-risk-mitigation.md#implementation-checklist)
  - [15. Deployment Strategy](./15-deployment-strategy.md)
    - [Deployment Checklist](./15-deployment-strategy.md#deployment-checklist)
  - [16. Coding Standards](./16-coding-standards.md)
    - [16.1 TypeScript Standards](./16-coding-standards.md#161-typescript-standards)
      - [Strict Mode Enforcement](./16-coding-standards.md#strict-mode-enforcement)
      - [Type Annotations](./16-coding-standards.md#type-annotations)
      - [No  Type](./16-coding-standards.md#no-type)
      - [Interface vs Type](./16-coding-standards.md#interface-vs-type)
    - [16.2 File & Folder Naming Conventions](./16-coding-standards.md#162-file-folder-naming-conventions)
      - [File Naming](./16-coding-standards.md#file-naming)
      - [Folder Naming](./16-coding-standards.md#folder-naming)
    - [16.3 Component Patterns](./16-coding-standards.md#163-component-patterns)
      - [Server Components by Default](./16-coding-standards.md#server-components-by-default)
      - [Component File Structure](./16-coding-standards.md#component-file-structure)
      - [Props Interface Naming](./16-coding-standards.md#props-interface-naming)
    - [16.4 API Route Patterns](./16-coding-standards.md#164-api-route-patterns)
      - [API Route Structure (Mandatory Order)](./16-coding-standards.md#api-route-structure-mandatory-order)
      - [API Response Format (Standardized)](./16-coding-standards.md#api-response-format-standardized)
    - [16.5 Database Query Patterns](./16-coding-standards.md#165-database-query-patterns)
      - [CRITICAL: Database as Source of Truth](./16-coding-standards.md#critical-database-as-source-of-truth)
      - [Repository Pattern (Mandatory)](./16-coding-standards.md#repository-pattern-mandatory)
      - [Query Optimization (Mandatory)](./16-coding-standards.md#query-optimization-mandatory)
    - [16.6 Testing Standards](./16-coding-standards.md#166-testing-standards)
      - [Test File Organization](./16-coding-standards.md#test-file-organization)
      - [Test Naming Convention](./16-coding-standards.md#test-naming-convention)
      - [Test Coverage Requirements](./16-coding-standards.md#test-coverage-requirements)
      - [Critical Test Cases (MUST Exist)](./16-coding-standards.md#critical-test-cases-must-exist)
    - [16.7 Documentation Standards](./16-coding-standards.md#167-documentation-standards)
      - [JSDoc for Public APIs](./16-coding-standards.md#jsdoc-for-public-apis)
      - [Inline Comments](./16-coding-standards.md#inline-comments)
      - [README Files](./16-coding-standards.md#readme-files)
  - [Common Pitfalls](#common-pitfalls)
  - [Testing](#testing)
  - [Summary](./summary.md)
  - [Summary](./summary.md)
